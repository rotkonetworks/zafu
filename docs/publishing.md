# publishing

zafu uses signed releases with verified CRX uploads to the chrome web store.

## extension IDs

| variant | extension ID | CWS listing |
|---------|-------------|-------------|
| production | `oojfeopgoeapfgcfhmlpfgabcbhkglck` | zafu |
| beta | `ppgbkpjgpggkibdojjocgndbbhiempjf` | zafu BETA |

## release process

1. tag a release: `git tag -s v0.1.0 -m "v0.1.0"`
2. push the tag: `git push origin v0.1.0`
3. the `release.yml` workflow triggers automatically and:
   - builds both prod (`dist/`) and beta (`beta-dist/`)
   - zips both builds
   - signs CRX files with extension private keys
   - computes sha256 checksums
   - creates a github release with all artifacts
   - uploads to chrome web store (skipped for alpha tags)

tags containing `alpha`, `beta`, or `rc` are marked as prereleases.

## signing

### CRX signing

each build variant has its own RSA 2048 key pair:
- `CRX_PROD_KEY` — signs production CRX, must match `key` in `manifest.json`
- `CRX_BETA_KEY` — signs beta CRX, must match `key` in `beta-manifest.json`

these are stored as github secrets. the public keys in the manifests are the
corresponding DER-encoded public keys, base64-encoded.

### git tag signing

tags are signed with GPG key `E468EC955CD56FF9`. add the public key to your
github account for tags to show as "verified":

```
gpg --armor --export E468EC955CD56FF9
```

## required github secrets

| secret | description |
|--------|-------------|
| `CRX_PROD_KEY` | RSA private key (PEM) for production CRX signing |
| `CRX_BETA_KEY` | RSA private key (PEM) for beta CRX signing |
| `GOOGLE_CLIENT_ID` | chrome web store API client ID |
| `GOOGLE_CLIENT_SECRET` | chrome web store API client secret |
| `GOOGLE_REFRESH_TOKEN` | chrome web store API refresh token |

CWS API credentials can be generated by following the
[chrome webstore API guide](https://developer.chrome.com/docs/webstore/using_webstore_api/).

## setup checklist

- [ ] create CWS listings for both extension IDs
- [ ] register the public keys from manifests with CWS
- [ ] add `CRX_PROD_KEY` and `CRX_BETA_KEY` github secrets (PEM contents)
- [ ] generate and add CWS API credentials as github secrets
- [ ] add GPG public key (`E468EC955CD56FF9`) to github account
